# FPGA 矩阵计算器 - 上板测试说明书

本指南提供验证 FPGA 矩阵计算器功能的详细步骤。所有按键和引脚定义均基于 `constraints.xdc` 文件。

## 1. 硬件引脚与连接说明

在开始测试前，请确保了解以下硬件定义：

*   **复位键 (Reset)**: `sys_rst_n` -> **Pin P15** (按下复位)
*   **确认键 (Confirm)**: `btn_pin[2]` -> **Pin R15** (用于确认操作、进入模式)
*   **拨码开关 (Switches)**: `sw_pin[7:0]`
    *   `sw_pin[7]` (Pin R1) - `sw_pin[5]` (Pin M4): **模式选择 (Mode Select)**
    *   `sw_pin[2]` (Pin P3) - `sw_pin[0]` (Pin P5): **参数设置 (Opcode / Slot)**
*   **串口 (UART)**:
    *   `PC_Uart_rxd` -> **Pin N5** (FPGA 接收)
    *   `PC_Uart_txd` -> **Pin T4** (FPGA 发送)
    *   **波特率**: 115200

---

## 2. 准备工作

1.  **连接**: 使用 USB 线连接开发板与电脑。
2.  **终端设置**: 打开串口调试助手（如 Serial Port Utility, Putty）。
    *   波特率: **115200**
    *   数据位: 8, 停止位: 1, 校验位: None
3.  **复位**: 上电后，按下 **Pin P15 (sys_rst_n)** 复位系统。
    *   *现象*: 数码管应显示初始状态（如 "IDLE" 或全0），LED 熄灭。

---

## 3. 测试用例 1: 矩阵输入 (Slot A)
**目标**: 手动输入一个 3x3 矩阵到存储槽位 A。

1.  **设置模式**: 将拨码开关 `sw_pin[7:5]` (R1, N4, M4) 拨至 `000` (输入模式)。
2.  **选择槽位**: 将 `sw_pin[1:0]` (P4, P5) 拨至 `00` (选择 Slot A)。
3.  **进入输入状态**: 按下 **Pin R15 (btn_pin[2])**。
    *   *现象*: 数码管显示 "InPut" 或类似提示。
4.  **发送数据**: 在电脑串口助手中发送以下 ASCII 字符串（数字间需有空格，**最后一个数字后也必须加空格或回车**）：
    ```text
    3 3 1 2 3 4 5 6 7 8 9 
    ```
    *(格式: `行数` `列数` `数据1` ... `数据9`，注意结尾要有一个空格)*
5.  **完成**: 发送完毕后，系统自动返回 IDLE (此时 G4 LED 应变回**常亮**)。

---

## 4. 测试用例 2: 矩阵输入 (Slot B)
**目标**: 输入一个 3x3 单位矩阵到存储槽位 B。

1.  **设置模式**: `sw_pin[7:5]` = `000` (输入模式)。
2.  **选择槽位**: `sw_pin[1:0]` = `01` (选择 Slot B)。
3.  **进入输入状态**: 按下 **Pin R15 (btn_pin[2])**。
4.  **发送数据**:
    ```text
    3 3 1 0 0 0 1 0 0 0 1 
    ```
5.  **完成**: 系统返回 IDLE。

---

## 5. 测试用例 3: 矩阵展示 (验证输入)
**目标**: 验证 Slot A 中的数据是否存储正确。

1.  **设置模式**: `sw_pin[7:5]` = `010` (展示模式)。
2.  **选择槽位**: `sw_pin[1:0]` = `00` (选择 Slot A)。
3.  **执行**: 按下 **Pin R15 (btn_pin[2])**。
4.  **观察**: 串口助手应打印矩阵 A 的内容：
    ```text
    1 2 3 4 5 6 7 8 9
    ```

---

## 6. 测试用例 4: 矩阵加法 (A + B)
**目标**: 计算 A + B。预期结果: `[2 2 3; 4 6 6; 7 8 10]`。

1.  **设置模式**: `sw_pin[7:5]` = `011` (计算模式)。
2.  **进入计算菜单**: 按下 **Pin R15 (btn_pin[2])**。
3.  **选择运算类型**: 设置 `sw_pin[2:0]` (P3, P4, P5) 为 `000` (ADD)。
4.  **确认运算**: 按下 **Pin R15 (btn_pin[2])**。
5.  **确认执行**: 再次按下 **Pin R15 (btn_pin[2])** (触发计算)。
6.  **观察结果**: 串口自动打印计算结果：
    ```text
    2 2 3 4 6 6 7 8 10
    ```

---

## 7. 测试用例 5: 矩阵乘法 (A * B)
**目标**: 计算 A * I (单位矩阵)。结果应等于 A。

1.  **设置模式**: `sw_pin[7:5]` = `011` (计算模式)。
2.  **进入计算菜单**: 按下 **Pin R15 (btn_pin[2])**。
3.  **选择运算类型**: 设置 `sw_pin[2:0]` = `010` (MUL)。
4.  **确认运算**: 按下 **Pin R15 (btn_pin[2])**。
5.  **确认执行**: 按下 **Pin R15 (btn_pin[2])**。
6.  **观察结果**: 串口打印结果应与 A 一致：
    ```text
    1 2 3 4 5 6 7 8 9
    ```

---

## 8. 测试用例 6: 标量乘法 (A * k)
**目标**: 计算 A * 2。

1.  **设置模式**: `sw_pin[7:5]` = `011` (计算模式)。
2.  **进入计算菜单**: 按下 **Pin R15 (btn_pin[2])**。
3.  **选择运算类型**: 设置 `sw_pin[2:0]` = `011` (SCA)。
4.  **确认运算**: 按下 **Pin R15 (btn_pin[2])**。
5.  **设置标量值**: 设置 `sw_pin[7:0]` 为二进制 `00000010` (即 k=2)。
    *   *注意*: 此时 `sw_pin[1]` (P4) 应为高电平 (1)，其余为低电平。请根据板上丝印确认开关位置。
6.  **确认执行**: 按下 **Pin R15 (btn_pin[2])**。
7.  **观察结果**:
    ```text
    2 4 6 8 10 12 14 16 18
    ```

---

## 9. 测试用例 7: 矩阵转置 (A^T)
**目标**: 转置矩阵 A。

1.  **设置模式**: `sw_pin[7:5]` = `011` (计算模式)。
2.  **进入计算菜单**: 按下 **Pin R15 (btn_pin[2])**。
3.  **选择运算类型**: 设置 `sw_pin[2:0]` = `100` (TRA)。
4.  **确认运算**: 按下 **Pin R15 (btn_pin[2])**。
5.  **确认执行**: 按下 **Pin R15 (btn_pin[2])**。
6.  **观察结果**:
    ```text
    1 4 7 2 5 8 3 6 9
    ```

---

## 10. 测试用例 8: 随机生成 (Random Gen)
**目标**: 用随机数填充 Slot A。

1.  **设置模式**: `sw_pin[7:5]` = `001` (随机模式)。
2.  **执行**: 按下 **Pin R15 (btn_pin[2])**。
3.  **验证**: 使用 **测试用例 3 (展示模式)** 查看 Slot A，数据应已更新。

---

## 11. 测试用例 9: 卷积演示 (Bonus)
**目标**: 演示卷积加速器功能。

1.  **设置模式**: `sw_pin[7:5]` = `100` (Bonus模式)。
2.  **执行**: 按下 **Pin R15 (btn_pin[2])**。
3.  **观察**: 串口将接收到连续的字符流（如 `*`），表明加速器正在运行。

---

## 常见问题 (FAQ)
*   **Q: 串口输出乱码？**
    *   A: 请检查波特率是否严格设置为 **115200**。
*   **Q: 按键没反应？**
    *   A: 确认是否按下了正确的键：**R15** 是确认键，**P15** 是复位键。
*   **Q: 标量乘法结果不对？**
    *   A: 在标量乘法确认Opcode后，需要重新调整所有拨码开关 `sw_pin[7:0]` 来表示标量值 k。务必在按下最后一次确认键前设置好。
