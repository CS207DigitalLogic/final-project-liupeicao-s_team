# CS207 Project - 基于FPGA的矩阵计算器

## 1. 项目简介
本项目实现了一个基于FPGA的矩阵计算器，支持矩阵输入、生成、存储、展示及多种运算功能（加法、减法、乘法、标量乘法、转置及卷积）。系统通过UART串口与PC进行交互，并使用数码管和LED作为状态指示。

## 2. 核心功能与验证方法

### 2.1 矩阵输入 (Input Mode)
**操作步骤**:
1.  设置 `SW[7:5] = 000` (Input Mode)。
2.  设置 `SW[1:0] = 00` (选择 Slot A)。
3.  按下 `Btn_C` (确认键)。
4.  通过串口依次发送矩阵维度 `M` 和 `N` (例如 `2` `3`)。
5.  依次发送矩阵元素 (例如 `1` `2` `3` `4` `5` `6`)。
6.  若要输入矩阵 B，重复步骤1-5，但需将 **步骤2改为 `SW[1:0] = 01`**。

**检查点**:
*   数码管应显示 "InPut"。
*   输入过程中，数码管后两位显示已输入的元素计数。
*   输入完成后，状态机自动返回 IDLE。

### 2.2 矩阵生成 (Gen Mode)
**操作步骤**:
1.  设置 `SW[7:5] = 001` (Gen Mode)。
2.  设置 `SW[1:0]` 选择目标 Slot (00=A, 01=B)。
3.  按下 `Btn_C`。

**检查点**:
*   数码管显示 "GEn"。
*   系统自动填充指定 Slot 的矩阵数据 (随机数)。

### 2.3 矩阵运算 (Calc Mode)
**操作步骤**:
1.  设置 `SW[7:5] = 011` (Calc Mode)。
2.  按下 `Btn_C` 进入运算选择状态 (数码管显示 "CALC")。
3.  设置 `SW[4:2]` 选择运算类型:
    *   `000`: 加法 (Add) -> 数码管显示 'A'
    *   `001`: 减法 (Sub) -> 数码管显示 'S'
    *   `010`: 乘法 (Mul) -> 数码管显示 'C'
    *   `011`: 标量乘 (Sca) -> 数码管显示 'b'
    *   `100`: 转置 (Tra) -> 数码管显示 'T'
4.  按下 `Btn_C` 确认运算类型。
5.  按下 `Btn_C` 确认运算数 (默认选择 Slot A 和 B)。
    *   如果是标量乘法，需先设置 `SW[7:0]` 为标量值，再按 `Btn_C`。

**检查点**:
*   运算完成后，串口输出结果矩阵。
*   结果矩阵格式为 `[ 1 2 \n 3 4 \n ]`。

### 2.4 错误处理与倒计时配置
**功能描述**:
当运算维度不匹配时 (例如 2x3 加 3x2)，系统进入错误状态，LED点亮，数码管显示 "Err XX" 倒计时。
用户可在倒计时内调整输入或重新确认。

**倒计时配置 (动态)**:
1.  在 IDLE 状态下 (且非其他模式)，设置 `SW[7:5] = 101` (Config Mode)。
2.  通过串口发送一个数字 (5-15)，例如 `10`。
3.  系统将更新错误倒计时时长 (默认为 10秒)。

**验证**:
1.  故意构造维度不匹配的运算 (如 A=2x3, B=2x2, 执行加法)。
2.  观察数码管是否显示 "Err 10" 并倒数。
3.  尝试配置倒计时为 5秒，重复测试，观察倒计时是否从 5 开始。

### 2.5 卷积运算 (Bonus Mode)
**功能描述**:
实现步长为 1 的 3x3 卷积运算，输入图像为 Hardcoded 的 10x12 矩阵。

**操作步骤**:
1.  首先需要输入一个 3x3 的卷积核矩阵 (作为矩阵 A 输入)。
    *   `SW[7:5]=000`, `SW[1:0]=00` (Slot A)。
    *   串口输入: `3` `3` (维度)，然后输入 9 个元素 (例如 `1 0 0 0 1 0 0 0 1`)。
2.  设置 `SW[7:5] = 100` (Bonus Mode)。
3.  按下 `Btn_C` 开始卷积计算。

**检查点**:
*   系统自动进行卷积计算，串口输出结果矩阵 (8行 x 10列)。
*   **计算完成后**，数码管显示 `Cy XXXX` (XXXX 为十进制的时钟周期数)。
*   例如: 若计算耗时 720 个周期，数码管显示 `Cy 720`。
*   若未完成计算，数码管显示 `bonUS J`。

## 3. 仿真指南
使用 `iverilog` 进行全系统仿真:
```bash
iverilog -o calc_sim.vvp calckit/tb_top.v calckit/top.v calckit/Central_FSM.v calckit/cmd_parser.v calckit/matrix_mem.v calckit/matrix_gen.v calckit/matrix_alu.v calckit/bonus_conv.v calckit/uart_rx.v calckit/uart_tx.v calckit/Timer_Unit.v calckit/LED_Driver.v calckit/Seg_Driver.v
vvp calc_sim.vvp
```
仿真将依次执行所有运算模式并打印状态跳转信息。

## 4. 资源统计
(请在 Vivado 中 Implementation 后查看 Report Utilization)
